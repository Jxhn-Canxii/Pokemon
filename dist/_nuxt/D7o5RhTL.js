import{_ as W,V as P}from"./BgMq0hds.js";import{_ as q}from"./BTZhcGdv.js";import{_ as H,a as J,b as K}from"./BtdaXWqS.js";import{_ as N}from"./BkuQPsS-.js";import{_ as Q}from"./7bhDg-qu.js";import{r as d,z as X,c as u,b as l,w as i,o as m,d as k,i as Y,a as n,h as Z,F as E,j as U,t as V,g as ee,f as se}from"./C3f4aPB-.js";import{r as oe,F as S,a as w,B as C,A,h as te}from"./CcP0DOW9.js";import"./o7ON5bpy.js";import"./CMuC9vtR.js";import"./CUORWU_8.js";const ae={class:"divide-y divide-gray-200 border-t border-dashed mt-2"},le={class:"flex items-center mb-4"},ne={class:"ml-2 text-sm font-semibold uppercase"},re={class:"ml-4 grid grid-cols-2 gap-2"},ie={key:0,class:"text-red-500 text-sm mt-1"},de={class:"flex justify-end"},ge={__name:"EditRole",props:{data:Object},emits:["transaction_id"],setup($,{emit:B}){const c=d(!1),t=d({role_id:0,role_name:"",permission_ids:[]}),p=d({}),r=d({}),b=d(!1),x=d({}),F=B,y=$,j=()=>{c.value=!0,R()},R=async()=>{try{const o=S({role_id:y.data.id}),e=await w.post(`${P}roles/get-permissions-by-role`,o,C());if(e.data&&e.data.permissions){const s={};t.value.permission_ids=[],e.data.permissions.forEach(a=>{s[a.type]||(s[a.type]=[]),a.isPermission&&t.value.permission_ids.push(a.id),s[a.type].push(a)}),r.value=s,t.value.role_id=y.data.id,t.value.role_name=y.data.name}}catch(o){te(o)}},O=async()=>{var o,e;try{p.value={};const s=S(t.value),a=await w.post(`${P}roles/add-permissions-role`,s,C());c.value=!1,A("success","Success",a.data.message),F("transaction_id",Math.random())}catch(s){s.response&&s.response.data&&s.response.data.errors?p.value=s.response.data.errors:A("error","Error",((e=(o=s.response)==null?void 0:o.data)==null?void 0:e.message)||"An error occurred.")}},D=o=>{b.value=o,t.value.permission_ids=o?Object.values(r.value).flat().map(e=>e.id):[],Object.keys(r.value).forEach(e=>{x.value[e]=o})},G=o=>(r.value[o]||[]).every(s=>t.value.permission_ids.includes(s.id)),M=o=>{const e=!x.value[o];x.value[o]=e;const s=r.value[o]||[];e?t.value.permission_ids.push(...s.map(a=>a.id)):t.value.permission_ids=t.value.permission_ids.filter(a=>!s.map(g=>g.id).includes(a))};return X(()=>r.value,o=>{b.value&&(t.value.permission_ids=Object.values(o).flat().map(e=>e.id))}),(o,e)=>{const s=W,a=q,g=K,h=N,I=J,L=Q,T=H;return m(),u("div",null,[l(s,{icon:"i-heroicons-pencil",color:"yellow",onClick:j},{default:i(()=>e[3]||(e[3]=[k(" Edit ")])),_:1}),l(T,{show:c.value,title:"Edit Permissions",onClose:e[2]||(e[2]=_=>c.value=!1),maxWidth:"2xl"},{default:i(()=>[l(L,null,{default:i(()=>[l(I,{onSubmit:Y(O,["prevent"]),class:"space-y-4"},{default:i(()=>[e[6]||(e[6]=n("h3",{class:"text-lg font-semibold"},"Edit Role",-1)),e[7]||(e[7]=n("hr",null,null,-1)),l(g,{label:"Role Name"},{default:i(()=>[l(a,{modelValue:t.value.role_name,"onUpdate:modelValue":e[0]||(e[0]=_=>t.value.role_name=_),disabled:"",class:"bg-gray-200"},null,8,["modelValue"])]),_:1}),e[8]||(e[8]=n("h3",{class:"text-md font-semibold"},"User Permissions",-1)),l(h,{checked:b.value,onChange:D},{default:i(()=>e[4]||(e[4]=[k(" Select All ")])),_:1},8,["checked"]),n("div",ae,[(m(!0),u(E,null,U(r.value,(_,v)=>(m(),u("div",{key:v,class:"py-2"},[n("div",le,[l(h,{checked:G(v),onChange:f=>M(v)},null,8,["checked","onChange"]),n("span",ne,V(v),1)]),n("div",re,[(m(!0),u(E,null,U(_,f=>(m(),ee(h,{key:f.id,modelValue:t.value.permission_ids,"onUpdate:modelValue":e[1]||(e[1]=z=>t.value.permission_ids=z),value:f.id,label:se(oe)(f.name)},null,8,["modelValue","value","label"]))),128))])]))),128))]),p.value.permission_ids?(m(),u("p",ie,V(p.value.permission_ids[0]),1)):Z("",!0),n("div",de,[l(s,{type:"submit",color:"blue"},{default:i(()=>e[5]||(e[5]=[k("Submit")])),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])])}}};export{ge as default};
