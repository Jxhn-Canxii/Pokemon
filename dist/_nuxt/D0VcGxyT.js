import{_ as T,V as k}from"./BgMq0hds.js";import{_ as q}from"./BTZhcGdv.js";import{_ as J,a as N,b as W}from"./BtdaXWqS.js";import{_ as H}from"./BkuQPsS-.js";import{_ as K}from"./7bhDg-qu.js";import{r as d,z as Q,c,b as l,w as i,o as u,d as g,i as X,a as r,h as Y,n as Z,t as A,F as P,j as U,g as ee,f as se}from"./C3f4aPB-.js";import{r as oe,F as V,a as S,B as C,A as R,h as te}from"./CcP0DOW9.js";import"./o7ON5bpy.js";import"./CMuC9vtR.js";import"./CUORWU_8.js";const ae={key:0,class:"text-red-500 text-sm mt-1"},le={class:"divide-y divide-gray-200 border-t border-dashed"},re={class:"flex items-center mb-4"},ne={class:"ml-2 text-sm font-semibold uppercase"},ie={class:"ml-4 grid grid-cols-2 gap-2"},de={class:"flex justify-end"},ge={__name:"AddRole",emits:["transaction_id"],setup(ue,{emit:w}){const _=d(!1),t=d({role_id:0,role_name:"",permission_ids:[]}),m=d({}),n=d({}),p=d(!1),v=d({}),B=w,F=()=>{_.value=!0,$()},$=async()=>{try{const o=V({encryption_key:"Joke!"}),e=await S.post(`${k}permissions/list-no-page`,o,C());if(e.data&&e.data.permissions){const s={};e.data.permissions.forEach(a=>{s[a.type]||(s[a.type]=[]),s[a.type].push(a)}),n.value=s}else console.error("Permissions data is not available",e.data)}catch(o){te(o)}},E=async()=>{var o,e;try{m.value={};const s=V(t.value),a=await S.post(`${k}roles/add-role`,s,C());_.value=!1,R("success","Success",a.data.message),j(),B("transaction_id",Math.random())}catch(s){s.response&&s.response.data&&s.response.data.errors?m.value=s.response.data.errors:R("error","Error",((e=(o=s.response)==null?void 0:o.data)==null?void 0:e.message)||"An error occurred.")}},j=()=>{t.value.role_id=0,t.value.role_name="",t.value.permission_ids=[],p.value=!1,v.value={}},D=o=>{p.value=o,t.value.permission_ids=o?Object.values(n.value).flat().map(e=>e.id):[],Object.keys(n.value).forEach(e=>{v.value[e]=o})},G=o=>(n.value[o]||[]).every(s=>t.value.permission_ids.includes(s.id)),M=o=>{const e=!v.value[o];v.value[o]=e;const s=n.value[o]||[];e?t.value.permission_ids.push(...s.map(a=>a.id)):t.value.permission_ids=t.value.permission_ids.filter(a=>!s.map(y=>y.id).includes(a))};return Q(()=>n.value,o=>{p.value&&(t.value.permission_ids=Object.values(o).flat().map(e=>e.id))}),(o,e)=>{const s=T,a=q,y=W,h=H,O=N,z=K,I=J;return u(),c("div",null,[l(s,{icon:"i-heroicons-user-plus",color:"blue",onClick:F},{default:i(()=>e[3]||(e[3]=[g(" Add Role ")])),_:1}),l(I,{show:_.value,title:"Add Role",onClose:e[2]||(e[2]=f=>_.value=!1),maxWidth:"2xl"},{default:i(()=>[l(z,null,{default:i(()=>[l(O,{onSubmit:X(E,["prevent"]),class:"space-y-4"},{default:i(()=>[e[6]||(e[6]=r("h3",{class:"text-lg font-semibold"},"Add Role",-1)),e[7]||(e[7]=r("hr",null,null,-1)),l(y,{label:"Role Name",required:""},{default:i(()=>[l(a,{modelValue:t.value.role_name,"onUpdate:modelValue":e[0]||(e[0]=f=>t.value.role_name=f),placeholder:"Enter Role Name",class:Z({"border-red-500":m.value.role_name})},null,8,["modelValue","class"]),m.value.role_name?(u(),c("p",ae,A(m.value.role_name[0]),1)):Y("",!0)]),_:1}),e[8]||(e[8]=r("h3",{class:"text-md font-semibold"},"User Permissions",-1)),l(h,{checked:p.value,onChange:D},{default:i(()=>e[4]||(e[4]=[g(" Select All ")])),_:1},8,["checked"]),r("div",le,[(u(!0),c(P,null,U(n.value,(f,x)=>(u(),c("div",{key:x,class:"py-2"},[r("div",re,[l(h,{checked:G(x),onChange:b=>M(x)},null,8,["checked","onChange"]),r("span",ne,A(x),1)]),r("div",ie,[(u(!0),c(P,null,U(f,b=>(u(),ee(h,{key:b.id,modelValue:t.value.permission_ids,"onUpdate:modelValue":e[1]||(e[1]=L=>t.value.permission_ids=L),value:b.id,label:se(oe)(b.name)},null,8,["modelValue","value","label"]))),128))])]))),128))]),r("div",de,[l(s,{type:"submit",color:"blue"},{default:i(()=>e[5]||(e[5]=[g("Submit")])),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])])}}};export{ge as default};
